import sys
import logging
from browser_agent import BrowserAgent

# ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s | %(levelname)s | %(message)s',
    datefmt='%H:%M:%S',
    handlers=[logging.StreamHandler(sys.stdout)]
)

def main():
    print("\n" + "="*60)
    print("ğŸš€ Ğ£ĞĞ˜Ğ’Ğ•Ğ Ğ¡ĞĞ›Ğ¬ĞĞ«Ğ™ Ğ‘Ğ ĞĞ£Ğ—Ğ•Ğ ĞĞ«Ğ™ ĞĞ“Ğ•ĞĞ¢")
    print("   GigaChat + Playwright")
    print("="*60 + "\n")
    
    # ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹ Ğ·Ğ°Ğ´Ğ°Ñ‡
    print("ğŸ’¡ ĞŸĞ Ğ˜ĞœĞ•Ğ Ğ« Ğ—ĞĞ”ĞĞ§:")
    print("   â€¢ ĞĞ°Ğ¹Ğ´Ğ¸ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¿Ğ¾Ñ€Ğ¾Ğ´Ğµ ĞºĞ¾ÑˆĞµĞº ÑÑ„Ğ¸Ğ½ĞºÑ")
    print("   â€¢ ĞŸĞµÑ€ĞµĞ¹Ğ´Ğ¸ Ğ½Ğ° ÑĞ°Ğ¹Ñ‚ Ğ’Ğ¸ĞºĞ¸Ğ¿ĞµĞ´Ğ¸Ğ¸ Ğ¸ Ğ½Ğ°Ğ¹Ğ´Ğ¸ ÑÑ‚Ğ°Ñ‚ÑŒÑ Ğ¿Ñ€Ğ¾ Ğ˜ÑĞºÑƒÑÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¸Ğ½Ñ‚ĞµĞ»Ğ»ĞµĞºÑ‚")
    print("   â€¢ ĞŸĞ¾Ğ¸Ñ‰Ğ¸ Ğ² Ğ¯Ğ½Ğ´ĞµĞºÑĞµ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ğ¾ÑÑ‚Ğ¸ Ğ¿Ñ€Ğ¾ ĞºĞ¾ÑĞ¼Ğ¾Ñ")
    print("   â€¢ ĞĞ°Ğ¹Ğ´Ğ¸ Ñ€ĞµÑ†ĞµĞ¿Ñ‚ Ğ±Ğ»Ğ¸Ğ½Ğ¾Ğ² Ğ½Ğ° ÑĞ°Ğ¹Ñ‚Ğµ Ğ¿Ğ¾Ğ²Ğ°Ñ€Ñ‘Ğ½Ğ¾Ğº.Ñ€Ñƒ")
    print("\n" + "="*60 + "\n")
    
    agent = None
    try:
        print("â³ Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ°Ğ³ĞµĞ½Ñ‚Ğ°...")
        agent = BrowserAgent()
        print("âœ… ĞĞ³ĞµĞ½Ñ‚ Ğ³Ğ¾Ñ‚Ğ¾Ğ²!\n")
        print("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n")
        
        while True:
            # Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ñƒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
            task = input("âœï¸  Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ñƒ Ğ´Ğ»Ñ Ğ°Ğ³ĞµĞ½Ñ‚Ğ° (Ğ¸Ğ»Ğ¸ 'Ğ²Ñ‹Ñ…Ğ¾Ğ´' Ğ´Ğ»Ñ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ñ):\n> ").strip()
            
            if task.lower() in ["Ğ²Ñ‹Ñ…Ğ¾Ğ´", "exit", "quit", "q"]:
                print("\nğŸ‘‹ Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹...")
                break
            
            if not task:
                print("âš ï¸  ĞŸÑƒÑÑ‚Ğ°Ñ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ°. ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ ÑĞ½Ğ¾Ğ²Ğ°.\n")
                continue
            
            print("\n" + "="*60)
            print("â³ ĞĞ³ĞµĞ½Ñ‚ Ğ¿Ñ€Ğ¸ÑÑ‚ÑƒĞ¿Ğ¸Ğ» Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğµ...")
            print("   (Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚ Ğ² Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾Ğ¼ Ğ¾ĞºĞ½Ğµ)")
            print("="*60 + "\n")
            
            # Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸
            result = agent.think_and_act(task)
            
            # Ğ’Ñ‹Ğ²Ğ¾Ğ´ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°
            print("\n" + "="*60)
            print("âœ… Ğ Ğ•Ğ—Ğ£Ğ›Ğ¬Ğ¢ĞĞ¢ Ğ’Ğ«ĞŸĞĞ›ĞĞ•ĞĞ˜Ğ¯:")
            print("="*60)
            print(result)
            print("\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n")
    
    except KeyboardInterrupt:
        print("\n\nâš ï¸  Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ° Ğ¿Ñ€ĞµÑ€Ğ²Ğ°Ğ½Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¼")
    except Exception as e:
        print(f"\nâŒ ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞĞ¯ ĞĞ¨Ğ˜Ğ‘ĞšĞ: {e}")
        import traceback
        traceback.print_exc()
    finally:
        if agent:
            print("\nâ³ Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğ°...")
            agent.close()
            print("âœ… Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾!")

if __name__ == "__main__":
    main()